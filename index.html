<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Token Video Player</title>
</head>
<body>
    <h1>Dynamic Video Player</h1>
    <button id="playButton">Play Video</button>

    <script>
        async function fetchTokenAndPlay() {
            try {
                const originalLink = "https://home.mycloud.com/action/share/d5ac552a-1f52-496e-87b4-1ba5f3d9b4ef";

                // Fetch the shared page to follow the redirection and find the token URL
                const response = await fetch(originalLink, { method: 'GET', redirect: 'follow' });

                // Extract the redirected URL
                const finalUrl = response.url;

                // Extract token from the final URL (or another endpoint if needed)
                const tokenMatch = finalUrl.match(/access_token=([^&]+)/);
                const token = tokenMatch ? tokenMatch[1] : null;

                if (token) {
                    const videoUrl = `vlc://https://device-local-9e7f3dc5-7a69-44a2-9672-b444b60548a0.remotewd.com:4430/sdk/v2/files/4jnh6z54xhmiyksgnl4obflx/content?access_token=${token}`;
                    console.log("Generated Video URL:", videoUrl);

                    // Open VLC with the video
                    window.location.href = videoUrl;
                } else {
                    console.error("Failed to extract token");
                }
            } catch (error) {
                console.error("Error fetching token:", error);
            }
        }

        document.getElementById('playButton').addEventListener('click', fetchTokenAndPlay);
    </script>
</body>
</html>
